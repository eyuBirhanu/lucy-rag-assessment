<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucy RAG Assistant</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="https://lucyhub.ai/favicon.ico">
</head>

<body>

    <div class="main-wrapper">
        <!-- Header -->
        <div class="top-nav d-flex justify-content-between align-items-center px-4 py-3 border-bottom shadow-sm">
            <div class="brand d-flex align-items-center gap-2">
                <div class="avatar-circle bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold"
                    style="width: 40px; height: 40px;">
                    <img src="https://lucyhub.ai/favicon.ico" alt="Lucy AI">
                </div>
                <div class="d-flex flex-column">
                    <span class="fw-bold">Lucy AI</span>
                    <span class="status-indicator small text-success"><i class="fas fa-circle"
                            style="font-size: 8px;"></i> Online</span>
                </div>
            </div>

            <div class="controls d-flex gap-2 align-items-center">
                <span class="badge rounded-pill text-bg-secondary d-none d-sm-inline-block"><i class="fas fa-globe"></i>
                    Real-time RAG</span>
                <button class="btn btn-sm btn-outline-secondary rounded-pill" onclick="toggleTheme()">
                    <i class="fas fa-sun" id="themeIcon"></i> Theme
                </button>
            </div>
        </div>

        <div class="container-fluid content-area flex-grow-1 overflow-hidden p-0">
            <div class="row h-100 g-0 justify-content-center m-0">

                <!-- LEFT SIDEBAR / MOBILE OFFCANVAS -->
                <div class="col-md-4 col-lg-3 offcanvas-md offcanvas-start border-end h-100 bg-body shadow-sm"
                    tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">

                    <!-- Mobile Drawer Header -->
                    <div class="offcanvas-header border-bottom d-md-none">
                        <h5 class="offcanvas-title fw-bold" id="sidebarMenuLabel">
                            <i class="fas fa-layer-group text-primary me-2"></i> Menu & Upload
                        </h5>
                        <button type="button" class="btn-close shadow-none" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>

                    <div class="offcanvas-body d-flex flex-column p-3 h-100 overflow-auto">
                        <!-- Document Upload Card -->
                        <div class="sidebar-card mb-3 card shadow-sm border-0 bg-body-tertiary">
                            <div class="card-body">
                                <h6 class="text-uppercase text-muted small fw-bold mb-3">Document Context</h6>

                                <!-- Upload Area -->
                                <div class="upload-zone rounded p-4 text-center" id="dropZone">
                                    <input type="file" id="pdfFile" accept="application/pdf" hidden
                                        onchange="handleFileSelect()">
                                    <div class="cursor-pointer" onclick="document.getElementById('pdfFile').click()">
                                        <i class="fas fa-cloud-upload-alt fa-3x mb-2 text-primary" id="uploadIcon"></i>
                                        <p class="mb-0 fw-bold" id="uploadText">Tap or Drag PDF</p>
                                        <p class="small text-muted mb-0" id="filenameDisplay">Supports .pdf only</p>
                                    </div>
                                    <div id="progressBar" class="progress mt-3" style="height: 6px; display: none;">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                                            role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 mt-3 rounded-pill fw-bold" id="uploadBtn"
                                    onclick="uploadPDF()" disabled>
                                    <i class="fas fa-bolt me-1"></i> Process Document
                                </button>
                                <div id="uploadStatus" class="mt-2 small text-center fw-bold"></div>
                            </div>
                        </div>

                        <!-- Chat Features Card -->
                        <div class="sidebar-card card shadow-sm border-0 bg-body-tertiary mt-auto">
                            <div class="card-body">
                                <h6 class="text-uppercase text-muted small fw-bold mb-3">Chat Features</h6>
                                <div class="feature-item d-flex align-items-center gap-3 mb-3">
                                    <div class="icon-box text-primary"><i class="fas fa-brain fa-lg"></i></div>
                                    <div>
                                        <div class="fw-bold small">Smart RAG</div>
                                        <div class="small text-muted" style="font-size: 0.75rem;">Context-aware answers
                                        </div>
                                    </div>
                                </div>
                                <div class="feature-item d-flex align-items-center gap-3 mb-3">
                                    <div class="icon-box text-warning"><i class="fas fa-bolt fa-lg"></i></div>
                                    <div>
                                        <div class="fw-bold small">Instant</div>
                                        <div class="small text-muted" style="font-size: 0.75rem;">Real-time generation
                                        </div>
                                    </div>
                                </div>
                                <hr class="border-secondary opacity-25">
                                <button class="btn btn-outline-danger btn-sm w-100 rounded-pill fw-bold"
                                    onclick="clearSession()">
                                    <i class="fas fa-trash-alt me-1"></i> Clear Session
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT MAIN CHAT AREA -->
                <div class="col-12 col-md-8 col-lg-9 h-100 d-flex flex-column chat-column position-relative">

                    <!-- Chat History -->
                    <div class="chat-history flex-grow-1 p-3 p-md-4 overflow-auto" id="chatBox">
                        <div class="d-flex flex-column align-items-center justify-content-center h-100 text-center opacity-50"
                            id="emptyState">
                            <i class="fas fa-comments fa-4x mb-3 text-secondary"></i>
                            <h4 class="fw-bold">Ready to Chat</h4>
                            <p class="px-4">Tap the <strong>+</strong> button below to upload a document.</p>
                        </div>
                    </div>

                    <!-- ChatGPT Style Input Area -->
                    <div class="chat-input-area p-3 bg-body border-top">
                        <div class="input-group rounded-pill border p-1 shadow-sm bg-body-tertiary align-items-center">

                            <!-- THE + BUTTON (Visible on Mobile only) -->
                            <button
                                class="btn btn-light rounded-circle ms-1 d-md-none text-secondary d-flex align-items-center justify-content-center shadow-sm"
                                type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu"
                                aria-controls="sidebarMenu"
                                style="width: 40px; height: 40px; border: none; background: var(--bs-secondary-bg);">
                                <i class="fas fa-plus"></i>
                            </button>

                            <input type="text" id="userInput"
                                class="form-control border-0 bg-transparent ps-3 shadow-none flex-grow-1"
                                placeholder="Message Lucy AI..." onkeypress="handleKeyPress(event)">

                            <button
                                class="btn btn-primary rounded-circle m-1 d-flex align-items-center justify-content-center shadow-sm"
                                style="width: 45px; height: 45px; flex-shrink: 0;" id="sendBtn" onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="text-center mt-2">
                            <span class="small text-muted" style="font-size: 0.70rem;">Lucy AI can make mistakes. Always
                                check the citations.</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- REQUIRED Bootstrap 5 JS Bundle (for the mobile menu/offcanvas to slide up) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/app.js"></script>
</body>

</html>